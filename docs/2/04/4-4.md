`/jfr` 명령어는 [[:snapshot: <span style="font-family:Minecraft-Event"/> Minecraft 21w37a (1.18 스냅샷)](https://www.minecraft.net/en-us/article/minecraft-snapshot-21w37a)]에 추가되었으며, [[Java Flight Recorder](https://openjdk.org/jeps/328)]를 이용해 측정합니다.

# 명령어
#### `/jfr start`
성능 측정을 시작합니다.

#### `/jfr stop`
성능 측정을 종료합니다.

측정이 종료되면 `.minecraft/debug` 폴더에 결과가 출력되며, 총 2개의 파일이 생성됩니다.

- jfr 파일
   - 클라이언트: `client-yyyy-MM-dd_HHmmss.jfr`
   - 서버: `server-yyyy-MM-dd_HHmmss.jfr`

- json 파일
   - 클라이언트: `jfr-report-client-yyyy-MM-dd-HHmmss.json`
   - 서버: `jfr-report-server-yyyy-MM-dd-HHmmss.json`

<br/>

# `.json` 파일 구조
- `ServerTick`(현재 `MSPT`, 부동소수점 오차 존재)
   - `minMs`: 최소 `MSPT`
   - `averageMs`: 평균 `MSPT`
   - `maxMs`: 최대 `MSPT`

- 백분위수: 전체 결과를 100으로 가정하고, 순서대로 정렬했을 때, `n` 번째 `MSPT`
   - `p99`: 99번째 `MSPT`
   - `p90`: 90번째 `MSPT`
   - `p75`: 75번째 `MSPT`
   - `p50`: 50번째 `MSPT`

### `example.json`
```json
"serverTick": {
   "minMs": 0.260423,
   "averageMs": 5.4426659347826085,
   "maxMs": 23.556856,
   "p99": 23.4405274,
   "p90": 22.342084,
   "p75": 1.7776407500000002,
   "p50": 0.5420765
}
```

<br/>

# `.jfr` 파일 구조
`.jfr` 파일은 일반적인 텍스트 에디터로 열 수 없기 때문에 해당 형식을 지원하는 프로그램을 통해 파일을 열어야 합니다.  
일반적으로 `IntelliJ` 혹은 `JDK Mission Control`과 같은 `JMC`를 이용합니다.

`IntelliJ`를 이용해 `.jfr` 파일을 드래그 앤 드롭하면 다음과 같은 화면이 표시됩니다.  
<img src="assets/img/docs/jfr/jfr1.png" height="512"/>

좌측 상단의 `Parent Process` 항목 밑에 `GC Heap Summary`, `CPU Load`, `Render thread` 등이 나열되어 있을 것입니다.  
이 목록을 스크롤 하면 다른 정보가 표시됩니다.  
<img src="assets/img/docs/jfr/jfr2.png" height="512"/>

이중에서 `Server thread` 항목을 살펴보면, 파란색 그래프가 요동치는 곳을 확인할 수 있습니다.  
그 부분이 성능 저하가 발생했던 부분입니다.  
<img src="assets/img/docs/jfr/jfr3.png" height="512"/>

또한, 그래프의 범위를 지정할 수 있습니다. (대략 15초 정도로 범위를 제한함)  
<img src="assets/img/docs/jfr/jfr4.png" height="512"/>

[[:paper: 04-2-3 /perf](#2/04-2-3)]에서 보았던 것과 마찬가지로 성능 저하가 심한 클래스부터 상단에 순서대로 정렬됩니다.  
나열된 클래스를 확인하기 위해 `.minecraft` 폴더로 이동한 후, `versions` 폴더를 찾아 폴더 안으로 들어갑니다.  
<img src="assets/img/docs/jfr/jfr5.png" height="128"/>  
<img src="assets/img/docs/jfr/jfr6.png" height="128"/>

그러면 지금까지 설치된 모든 버전의 마인크래프트 폴더를 확인할 수 있는데, 측정했던 버전과 맞는 폴더로 진입해 `.jar` 파일의 압축을 해제합니다.  
<img src="assets/img/docs/jfr/jfr7.png" height="128"/>  
<img src="assets/img/docs/jfr/jfr8.png" height="128"/>

압축을 해제하면 또 다른 폴더와 무수히 많은 `.class` 파일을 볼 수 있는데, `JMC`를 통해 보았던 난독화된 클래스를 매치시켜 내부 코드를 확인할 수 있습니다.  
<img src="assets/img/docs/jfr/jfr9.png" height="128"/>  
<img src="assets/img/docs/jfr/jfr10.png" height="512"/>  
<img src="assets/img/docs/jfr/jfr11.png" height="512"/>  

다만, 다음과 같은 문제가 있습니다.
- ~~클래스의 이름, 변수명이 달러 기호 및 알파벳 순서대로 표시된다.~~
- ~~연계된 클래스 및 메서드를 추적하여 확인하기가 까다롭다.~~

## 추가(2025. 10. 29)
모장이 [[:launcher: Removing obfuscation in Java Edition](https://www.minecraft.net/en-us/article/removing-obfuscation-in-java-edition)]을 공개했습니다.  
[[:snapshot: <span style="font-family:Minecraft-Event"/> Minecraft 25w45a](https://minecraft.wiki/w/Java_Edition_25w45a)] 버전 이후부터는 별도의 난독화가 이루어지지 않은 버전이 출시될 예정입니다. (`<version> Unobfuscated`)

따라서, 연계된 클래스 및 메서드를 추적하기가 훨씬 쉬워졌습니다.  
- 난독화 되지 않은 버전의 적용법은 [[:paper: 05-4 난독화 해제](#2/05-4)]를 참고하십시오.