`spark`는 마인크래프트 클라이언트 및 서버 성능 측정 모드입니다.

# 명령어
#### `/spark profiler start`
성능 측정을 시작합니다.

#### `/spark profiler stop`
성능 측정을 종료합니다.

#### `/spark profiler start --timeout <seconds>`
지정된 초만큼 성능을 측정합니다.
`<seconds>`는 11초 이상이어야합니다.

spark는 성능 측정이 종료되면, 다음과 같은 `url` 링크를 반환합니다.
- `https://spark.lucko.me/<Value>`: `<Value>`는 랜덤

링크를 통해 사이트에 접속하면, 다음과 같은 화면이 표시됩니다.  
<img src="assets/img/docs/spark/spark1.png" height="1024"/>

하단의 `Label: Percentage`를 `Label: Time per tick`으로 변경합니다.  
이후, 맨 하단의 `Server thread` 트리를 계속해서 열면 클래스 및 메서드 이름이 표시됩니다.  
<img src="assets/img/docs/spark/spark2.png" height="512"/>

역시 [[:paper: 04-2-3 /perf](#2/04-2-3)]과 마찬가지로 성능 저하가 심한 클래스 및 메서드가 상단부터 정렬됩니다.  
트리를 계속해서 펼친 결과 다홍색으로 표시된 부분이 성능을 저하시킨다는 것을 알았고, 실제 소스 코드를 확인해볼 수 있습니다.

<img src="assets/img/docs/spark/spark3.png" height="512"/>

그러나, 측정 환경이 바닐라가 아닌 모드이다보니 모장의 공식 클래스 및 메서드 명과는 다소 차이가 발생합니다.  
이때 매핑 변환기를 사용할 수 있습니다.

`Fabric`은 주로 `yarn`을 통해 클래스 및 메서드를 매핑합니다.  
그리고 매핑 변환을 도와주는 사이트로 접속하여, 검색을 시도하면 성공적으로 변환된 클래스 및 메서드를 확인할 수 있습니다.  
<img src="assets/img/docs/spark/spark4.png" height="512"/>  
<img src="assets/img/docs/spark/spark5.png" height="512"/>  
<img src="assets/img/docs/spark/spark6.png" height="512"/>

실제 코드와 메서드 이름이 같다는 걸 확인할 수 있습니다.  
<img src="assets/img/docs/spark/spark7.png" height="512"/>

이런식으로 비교 + 검색하면서 원인을 찾습니다.

다만, 다음과 같은 문제가 있습니다.
- 가끔씩 클래스나 메서드가 그대로 난독화되어 표시된다.

<br/>

더욱 자세한 사용법은 [[spark docs](https://spark.lucko.me/docs)]에서 확인할 수 있습니다.